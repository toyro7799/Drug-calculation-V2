<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ùíöùíêùíñùíîùíîùíÜùíá | Advanced Drug Calculation Test</title>
    
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Sharp" rel="stylesheet">
    
    <style>
        /* --- CSS Variables for Modern Theme --- */
        :root {
            --primary-color: #007BFF;
            --primary-color-dark: #0056b3;
            --secondary-color: rgba(255, 255, 255, 0.6); /* Frosted Glass */
            --text-color: #1a1c2c;
            --text-muted: #6c757d;
            --bg-color: #f4f7f9;
            --card-bg-color: #ffffff;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --white-color: #FFFFFF;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --border-color: rgba(0, 0, 0, 0.1);
            --border-radius: 16px;
            --transition-speed: 0.4s;
            --font-family: 'Poppins', sans-serif;
        }

        /* --- Dark Theme Variables --- */
        [data-theme="dark"] {
            --primary-color: #3694ff;
            --primary-color-dark: #007BFF;
            --secondary-color: rgba(43, 47, 64, 0.7);
            --text-color: #e0e0e0;
            --text-muted: #a0a0a0;
            --bg-color: #121212;
            --card-bg-color: #2b2f40;
            --shadow-color: rgba(0, 0, 0, 0.4);
            --border-color: rgba(255, 255, 255, 0.1);
        }

        /* --- Keyframe Animations --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes backgroundPan { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 10%, 30%, 50%, 70%, 90% { transform: translateX(-6px); } 20%, 40%, 60%, 80% { transform: translateX(6px); } }

        /* General Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.7;
            background: linear-gradient(135deg, #e0c3fc, #8ec5fc, #f4f7f9);
            background-size: 600% 600%;
            animation: backgroundPan 30s ease infinite;
            transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease;
        }
        [data-theme="dark"] body {
             background: linear-gradient(135deg, #232526, #414345, #121212);
             background-size: 600% 600%;
             animation: backgroundPan 30s ease infinite;
        }

        .container { max-width: 1100px; margin: 0 auto; padding: 0 2rem; }
        section { padding: 5rem 0; }

        /* Header & Navigation */
        .main-header {
            background-color: rgba(255, 255, 255, 0.8);
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 1000;
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            transition: box-shadow var(--transition-speed) ease, background-color var(--transition-speed) ease;
        }
        [data-theme="dark"] .main-header { background-color: rgba(30, 32, 44, 0.8); }

        .main-nav { display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 1.6rem; font-weight: 700; color: var(--primary-color); text-decoration: none; font-style: italic; }
        
        .nav-right { display: flex; align-items: center; gap: 1.5rem; }
        .nav-links { list-style: none; display: flex; gap: 2rem; }
        .nav-links a { text-decoration: none; color: var(--text-color); font-weight: 600; transition: color var(--transition-speed) ease; }
        .nav-links a:hover { color: var(--primary-color); }

        .theme-toggle {
            background: none; border: none; cursor: pointer; color: var(--text-color);
            display: flex; align-items: center; justify-content: center;
        }
        .theme-toggle .material-icons-sharp { font-size: 24px; transition: transform 0.5s ease; }
        .theme-toggle:hover .material-icons-sharp { transform: scale(1.1) rotate(15deg); color: var(--primary-color); }
        .theme-toggle .icon-dark { display: none; }
        [data-theme="dark"] .theme-toggle .icon-dark { display: block; }
        [data-theme="dark"] .theme-toggle .icon-light { display: none; }


        /* Hero Section */
        #hero {
            display: flex; align-items: center; justify-content: center; text-align: center;
            min-height: 80vh; padding: 4rem 2rem; color: var(--white-color);
        }
        .hero-content { animation: slideInUp 0.8s ease-out forwards; max-width: 700px; }
        .hero-content h1 {
            font-size: clamp(2.5rem, 5vw, 4rem); font-weight: 700; margin-bottom: 1rem;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }
        .hero-content p { font-size: 1.2rem; margin-bottom: 2.5rem; text-shadow: 1px 1px 5px rgba(0,0,0,0.5); }
        
        .cta-button {
            display: inline-block; background-color: var(--primary-color); color: var(--white-color);
            padding: 1rem 2.5rem; text-decoration: none; font-weight: 600; border-radius: 50px;
            transition: all var(--transition-speed) ease; border: none; font-size: 1rem; cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 123, 255, 0.4);
        }
        .cta-button:hover { transform: translateY(-5px); background-color: var(--primary-color-dark); box-shadow: 0 8px 25px rgba(0, 123, 255, 0.5); }

        /* Quiz Section Styles */
        .section-title {
            text-align: center; font-size: clamp(2rem, 4vw, 2.8rem); margin-bottom: 4rem;
            font-weight: 700; color: var(--text-color); animation: fadeIn 1s ease-in;
        }

        #quiz-container {
            background-color: var(--card-bg-color);
            padding: 2.5rem; border-radius: var(--border-radius);
            box-shadow: 0 10px 40px var(--shadow-color);
            border: 1px solid var(--border-color);
            max-width: 800px; margin: 0 auto;
            animation: fadeIn 1s ease-in;
            transition: background-color var(--transition-speed) ease;
        }

        #progress-container { margin-bottom: 2rem; }
        #progress-bar-container { width: 100%; background-color: var(--border-color); border-radius: 50px; height: 12px; overflow: hidden; }
        #progress-bar { height: 100%; width: 0%; background-color: var(--primary-color); border-radius: 50px; transition: width 0.5s ease-in-out; }
        #progress-text { text-align: right; margin-top: 0.5rem; font-weight: 600; color: var(--text-muted); font-size: 0.9rem;}

        #quiz-content.fade-out { opacity: 0; transform: scale(0.98); transition: opacity 0.2s ease-out, transform 0.2s ease-out; }
        #quiz-content.fade-in { opacity: 1; transform: scale(1); transition: opacity 0.4s ease-in, transform 0.4s ease-in; }

        #question-text { font-size: 1.25rem; margin-bottom: 2rem; color: var(--text-color); font-weight: 600; min-height: 80px; }
        .options-container { display: flex; flex-direction: column; gap: 1rem; margin-bottom: 2.5rem; }

        .option-button {
            background-color: var(--bg-color); color: var(--text-color); border: 2px solid var(--border-color);
            padding: 1rem 1.5rem; font-size: 1rem; border-radius: 12px; cursor: pointer;
            transition: all var(--transition-speed) ease; text-align: left; font-family: var(--font-family);
        }
        .option-button:hover:not(.disabled) { transform: translateY(-3px) scale(1.02); border-color: var(--primary-color); box-shadow: 0 4px 15px var(--shadow-color); }
        .option-button.correct { background-color: var(--success-color) !important; color: var(--white-color) !important; border-color: var(--success-color) !important; transform: scale(1.03); }
        .option-button.incorrect { background-color: var(--danger-color) !important; color: var(--white-color) !important; border-color: var(--danger-color) !important; animation: shake 0.5s ease; }
        .options-container.disabled { pointer-events: none; }
        .options-container.disabled .option-button:not(.correct):not(.incorrect) { opacity: 0.6; }

        /* Explanation Box */
        #explanation-box {
            background-color: var(--bg-color); border-left: 5px solid var(--primary-color);
            padding: 1.5rem; margin-top: 2rem; border-radius: 8px;
            max-height: 0; overflow: hidden; opacity: 0;
            transition: max-height 0.7s ease, opacity 0.7s ease, padding 0.7s ease;
        }
        #explanation-box.show { max-height: 500px; opacity: 1; padding: 1.5rem; }
        #explanation-box h4 { margin-bottom: 1rem; color: var(--primary-color); }
        #explanation-text { font-size: 1rem; color: var(--text-muted); }
        #explanation-text .mjx-char { color: var(--text-color) !important; }

        .quiz-actions { display: flex; justify-content: space-between; align-items: center; }
        .action-button {
            background-color: var(--primary-color); color: var(--white-color); padding: 0.8rem 1.8rem;
            border: none; border-radius: 50px; font-size: 1rem; font-weight: 600;
            cursor: pointer; transition: all var(--transition-speed) ease;
            box-shadow: 0 4px 15px rgba(0, 123, 255, 0.3);
        }
        .action-button:disabled { background-color: #cccccc; cursor: not-allowed; box-shadow: none; }
        .action-button:hover:not(:disabled) { background-color: var(--primary-color-dark); transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0, 123, 255, 0.4); }
        #show-explanation-btn {
            background-color: transparent; color: var(--primary-color); box-shadow: none;
            font-weight: 700; padding: 0.8rem 0; display: none;
        }
        #show-explanation-btn:hover:not(:disabled) { background-color: transparent; transform: none; box-shadow: none; text-decoration: underline; }

        /* Results Screen */
        #results-screen { padding: 2rem; text-align: center; animation: slideInUp 0.5s ease-out; }
        #result-summary { font-size: 1.8rem; font-weight: 700; margin-bottom: 1rem; }
        #result-summary .score { color: var(--primary-color); font-size: 2.5rem; }
        #result-message { font-size: 1.1rem; color: var(--text-muted); margin-bottom: 2.5rem; }
        #results-screen .cta-button { margin: 0.5rem; }

        #review-area { margin-top: 3rem; text-align: left; }
        .review-question {
            background-color: var(--bg-color); padding: 1rem 1.5rem; border-radius: 12px;
            margin-bottom: 1rem; border: 1px solid var(--border-color);
            display: flex; justify-content: space-between; align-items: center;
            cursor: pointer; transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .review-question:hover { transform: translateY(-3px); box-shadow: 0 4px 15px var(--shadow-color); }
        .review-question-text { flex-grow: 1; padding-right: 1rem; }
        .review-status { display: flex; align-items: center; gap: 0.5rem; font-weight: 600; }
        .review-status .material-icons-sharp { font-size: 24px; }
        .review-status.correct { color: var(--success-color); }
        .review-status.incorrect { color: var(--danger-color); }

        /* Footer */
        .main-footer {
            background-color: var(--text-color); color: #ccc;
            text-align: center; padding: 2rem 0; margin-top: 4rem;
        }
        [data-theme="dark"] .main-footer { background-color: #1a1c2c; }
        .main-footer p { margin: 0; }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-links { display: none; }
            .hero-content h1 { font-size: 2.5rem; }
            .hero-content p { font-size: 1rem; }
            #quiz-container { padding: 1.5rem; }
            #question-text { font-size: 1.1rem; min-height: 100px; }
        }
    </style>
</head>
<body data-theme="light">

    <header class="main-header">
        <nav class="container main-nav">
            <a href="#" class="logo" title="Youssef's Drug Calc Test">ùíöùíêùíñùíîùíîùíÜùíá</a>
            <div class="nav-right">
                <ul class="nav-links">
                    <li><a href="#hero">Home</a></li>
                    <li><a href="#questions">Start Test</a></li>
                </ul>
                <button class="theme-toggle" id="theme-toggle-btn" aria-label="Toggle light/dark theme">
                    <span class="material-icons-sharp icon-light">light_mode</span>
                    <span class="material-icons-sharp icon-dark">dark_mode</span>
                </button>
            </div>
        </nav>
    </header>

    <main>
        <section id="hero">
            <div class="hero-content">
                <h1>Advanced Drug Calculation Exam</h1>
                <p>Sharpen your clinical skills. Test your knowledge with these challenging calculation questions, now with detailed explanations.</p>
                <a href="#questions" class="cta-button">Start Test Now</a>
            </div>
        </section>

        <section id="questions">
            <div class="container">
                <h2 class="section-title">Test Your Knowledge</h2>
                <div id="quiz-container" style="display: none;">
                    
                    <div id="progress-container">
                         <div id="progress-text"></div>
                         <div id="progress-bar-container"><div id="progress-bar"></div></div>
                    </div>

                    <div id="quiz-content" class="quiz-content">
                        <p id="question-text">Question will appear here...</p>
                        <div id="options-container" class="options-container"></div>
                        <div id="explanation-box">
                             <h4>Calculation Breakdown</h4>
                             <div id="explanation-text"></div>
                        </div>
                    </div>

                    <div class="quiz-actions">
                        <button id="prev-button" class="action-button" disabled>Previous</button>
                        <button id="show-explanation-btn">Show Calculation</button>
                        <button id="next-button" class="action-button">Next</button>
                    </div>

                    <div id="results-screen" style="display: none;"></div>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        <div class="container">
            <p>&copy; 2025 ùíöùíêùíñùíîùíîùíÜùíá | Upgraded by Gemini. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const allQuestions = [
                {
                    question: "The doctor orders an IV medication to be infused at 4 mcg/kg/min. The patient weighs 75 kg. You are supplied with a bag of the IV medication that reads 250 mg/250 mL. How many mL/hr will you administer?",
                    options: ["9 mL/hr", "18 mL/hr", "36 mL/hr", "72 mL/hr"],
                    answer: "18 mL/hr",
                    explanation: "1. Calculate total dosage in mcg/min: $$\\small{4 \\text{ mcg/kg/min} \\times 75 \\text{ kg} = 300 \\text{ mcg/min}}$$ 2. Convert mcg/min to mg/hr: $$\\small{300 \\text{ mcg/min} \\times \\frac{60 \\text{ min}}{1 \\text{ hr}} \\times \\frac{1 \\text{ mg}}{1000 \\text{ mcg}} = 18 \\text{ mg/hr}}$$ 3. Determine concentration: $$\\small{\\frac{250 \\text{ mg}}{250 \\text{ mL}} = 1 \\text{ mg/mL}}$$ 4. Calculate the rate in mL/hr: $$\\small{\\frac{18 \\text{ mg/hr}}{1 \\text{ mg/mL}} = 18 \\text{ mL/hr}}$$ "
                },
                {
                    question: "Dr orders Fentanyl 75 mcg IV pre-procedural. The vial is labeled 0.5 mg/mL. How many mL will you give per dose?",
                    options: ["0.075 mL/dose", "0.15 mL/dose", "0.75 mL/dose", "1.5 mL/dose"],
                    answer: "0.15 mL/dose",
                    explanation: "1. Convert the available concentration to mcg/mL: $$\\small{0.5 \\text{ mg/mL} \\times \\frac{1000 \\text{ mcg}}{1 \\text{ mg}} = 500 \\text{ mcg/mL}}$$ 2. Use the formula: Desired / Have x Volume: $$\\small{\\frac{75 \\text{ mcg (Desired)}}{500 \\text{ mcg (Have)}} \\times 1 \\text{ mL} = 0.15 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Insulin 8 units subcutaneous daily. The vial is labeled 100 units/mL. How many mL will you give per dose?",
                    options: ["0.008 mL/dose", "0.04 mL/dose", "0.08 mL/dose", "0.8 mL/dose"],
                    answer: "0.08 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{8 \\text{ units (Desired)}}{100 \\text{ units (Have)}} \\times 1 \\text{ mL} = 0.08 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Morphine 6 mg IV as needed for pain. The vial is labeled 10 mg/mL. How many mL will you give per dose?",
                    options: ["0.06 mL/dose", "0.1 mL/dose", "0.6 mL/dose", "1.0 mL/dose"],
                    answer: "0.6 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{6 \\text{ mg (Desired)}}{10 \\text{ mg (Have)}} \\times 1 \\text{ mL} = 0.6 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Amiodarone 300 mg IV stat. The vial is labeled 900 mg/6 mL. How many mL will you give per dose?",
                    options: ["1 mL/dose", "2 mL/dose", "3 mL/dose", "4 mL/dose"],
                    answer: "2 mL/dose",
                    explanation: "1. Determine the concentration in mg/mL: $$\\small{\\frac{900 \\text{ mg}}{6 \\text{ mL}} = 150 \\text{ mg/mL}}$$ 2. Use the formula: Desired / Have x Volume. In this case, 'Have' is the concentration per mL: $$\\small{\\frac{300 \\text{ mg (Desired)}}{150 \\text{ mg/mL}} = 2 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Lactulose 20 Grams by mouth twice a day. The pharmacy dispenses you with 40 grams/60 mL. How many mL will you administer per dose?",
                    options: ["15 mL/dose", "20 mL/dose", "30 mL/dose", "40 mL/dose"],
                    answer: "30 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{20 \\text{ g (Desired)}}{40 \\text{ g (Have)}} \\times 60 \\text{ mL} = 0.5 \\times 60 \\text{ mL} = 30 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Dopamine to be infused at 5 mcg/kg/min. The patient weighs 60 kg. You are supplied with a bag of the IV medication that reads 400 mg/250 mL. How many mL/hr will you administer?",
                    options: ["5.625 mL/hr", "11.25 mL/hr", "22.5 mL/hr", "45 mL/hr"],
                    answer: "11.25 mL/hr",
                    explanation: "1. Calculate total dosage in mcg/min: $$\\small{5 \\text{ mcg/kg/min} \\times 60 \\text{ kg} = 300 \\text{ mcg/min}}$$ 2. Convert mcg/min to mg/hr: $$\\small{300 \\text{ mcg/min} \\times \\frac{60 \\text{ min}}{1 \\text{ hr}} \\times \\frac{1 \\text{ mg}}{1000 \\text{ mcg}} = 18 \\text{ mg/hr}}$$ 3. Determine concentration: $$\\small{\\frac{400 \\text{ mg}}{250 \\text{ mL}} = 1.6 \\text{ mg/mL}}$$ 4. Calculate the rate in mL/hr: $$\\small{\\frac{18 \\text{ mg/hr}}{1.6 \\text{ mg/mL}} = 11.25 \\text{ mL/hr}}$$ "
                },
                {
                    question: "Dr orders Heparin 5000 units subcutaneous daily. The vial is labeled 10,000 units/mL. How many mL will you give per dose?",
                    options: ["0.1 mL/dose", "0.25 mL/dose", "0.5 mL/dose", "1.0 mL/dose"],
                    answer: "0.5 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{5000 \\text{ units (Desired)}}{10000 \\text{ units (Have)}} \\times 1 \\text{ mL} = 0.5 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Atropine 0.5 mg IV pre-procedural. The vial is labeled 1 mg/mL. How many mL will you give per dose?",
                    options: ["0.1 mL/dose", "0.25 mL/dose", "0.5 mL/dose", "1.0 mL/dose"],
                    answer: "0.5 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{0.5 \\text{ mg (Desired)}}{1 \\text{ mg (Have)}} \\times 1 \\text{ mL} = 0.5 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Vancomycin 750 mg IV every 12 hours. The vial is labeled 1 g/10 mL. How many mL will you give per dose?",
                    options: ["0.75 mL/dose", "3.75 mL/dose", "7.5 mL/dose", "15 mL/dose"],
                    answer: "7.5 mL/dose",
                    explanation: "1. Convert grams to milligrams for the available dose: $$\\small{1 \\text{ g} = 1000 \\text{ mg}}$$ So, the available concentration is 1000 mg/10 mL. 2. Use the formula: Desired / Have x Volume: $$\\small{\\frac{750 \\text{ mg (Desired)}}{1000 \\text{ mg (Have)}} \\times 10 \\text{ mL} = 0.75 \\times 10 \\text{ mL} = 7.5 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Enoxaparin 40 mg subcutaneous daily. The vial is labeled 80 mg/0.8 mL. How many mL will you give per dose?",
                    options: ["0.2 mL/dose", "0.4 mL/dose", "0.6 mL/dose", "0.8 mL/dose"],
                    answer: "0.4 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{40 \\text{ mg (Desired)}}{80 \\text{ mg (Have)}} \\times 0.8 \\text{ mL} = 0.5 \\times 0.8 \\text{ mL} = 0.4 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Hydromorphone 2 mg IV as needed for pain. The vial is labeled 10 mg/mL. How many mL will you give per dose?",
                    options: ["0.1 mL/dose", "0.2 mL/dose", "0.5 mL/dose", "1.0 mL/dose"],
                    answer: "0.2 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{2 \\text{ mg (Desired)}}{10 \\text{ mg (Have)}} \\times 1 \\text{ mL} = 0.2 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Diltiazem to be infused at 10 mg/hr. You are supplied with a bag of the IV medication that reads 250 mg/250 mL. How many mL/hr will you administer?",
                    options: ["5 mL/hr", "10 mL/hr", "15 mL/hr", "20 mL/hr"],
                    answer: "10 mL/hr",
                    explanation: "1. Determine the concentration: $$\\small{\\frac{250 \\text{ mg}}{250 \\text{ mL}} = 1 \\text{ mg/mL}}$$ 2. Calculate the rate in mL/hr: $$\\small{\\frac{10 \\text{ mg/hr (Desired Rate)}}{1 \\text{ mg/mL (Concentration)}} = 10 \\text{ mL/hr}}$$ "
                },
                {
                    question: "Dr orders Potassium Chloride 20 mEq IV daily. The vial is labeled 40 mEq/20 mL. How many mL will you give per dose?",
                    options: ["5 mL/dose", "10 mL/dose", "15 mL/dose", "20 mL/dose"],
                    answer: "10 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{20 \\text{ mEq (Desired)}}{40 \\text{ mEq (Have)}} \\times 20 \\text{ mL} = 0.5 \\times 20 \\text{ mL} = 10 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Ondansetron 6 mg IV every 6 hours as needed for nausea. The vial is labeled 4 mg/2 mL. How many mL will you give per dose?",
                    options: ["1.5 mL/dose", "2 mL/dose", "3 mL/dose", "4.5 mL/dose"],
                    answer: "3 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{6 \\text{ mg (Desired)}}{4 \\text{ mg (Have)}} \\times 2 \\text{ mL} = 1.5 \\times 2 \\text{ mL} = 3 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Midazolam 4 mg IV pre-procedural. The vial is labeled 5 mg/mL. How many mL will you give per dose?",
                    options: ["0.4 mL/dose", "0.6 mL/dose", "0.8 mL/dose", "1.0 mL/dose"],
                    answer: "0.8 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{4 \\text{ mg (Desired)}}{5 \\text{ mg (Have)}} \\times 1 \\text{ mL} = 0.8 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Epinephrine to be infused at 0.1 mcg/kg/min. The patient weighs 90 kg. You are supplied with a bag of the IV medication that reads 1 mg/250 mL. How many mL/hr will you administer?",
                    options: ["22.5 mL/hr", "45 mL/hr", "90 mL/hr", "135 mL/hr"],
                    answer: "135 mL/hr",
                    explanation: "1. Calculate total dosage in mcg/min: $$\\small{0.1 \\text{ mcg/kg/min} \\times 90 \\text{ kg} = 9 \\text{ mcg/min}}$$ 2. Convert mcg/min to mcg/hr: $$\\small{9 \\text{ mcg/min} \\times \\frac{60 \\text{ min}}{1 \\text{ hr}} = 540 \\text{ mcg/hr}}$$ 3. Determine concentration in mcg/mL: $$\\small{\\frac{1 \\text{ mg}}{250 \\text{ mL}} = \\frac{1000 \\text{ mcg}}{250 \\text{ mL}} = 4 \\text{ mcg/mL}}$$ 4. Calculate the rate in mL/hr: $$\\small{\\frac{540 \\text{ mcg/hr}}{4 \\text{ mcg/mL}} = 135 \\text{ mL/hr}}$$ "
                },
                {
                    question: "Dr orders Metoprolol 12.5 mg IV every 6 hours. The vial is labeled 5 mg/mL. How many mL will you give per dose?",
                    options: ["1.25 mL/dose", "2.5 mL/dose", "3.75 mL/dose", "5 mL/dose"],
                    answer: "2.5 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{12.5 \\text{ mg (Desired)}}{5 \\text{ mg (Have)}} \\times 1 \\text{ mL} = 2.5 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Sodium Bicarbonate 50 mEq IV stat. The vial is labeled 100 mEq/50 mL. How many mL will you give per dose?",
                    options: ["12.5 mL/dose", "25 mL/dose", "37.5 mL/dose", "50 mL/dose"],
                    answer: "25 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume: $$\\small{\\frac{50 \\text{ mEq (Desired)}}{100 \\text{ mEq (Have)}} \\times 50 \\text{ mL} = 0.5 \\times 50 \\text{ mL} = 25 \\text{ mL}}$$ "
                },
                {
                    question: "Dr orders Ceftriaxone 1 g IV daily. The vial is labeled 2 g/10 mL. How many mL will you give per dose?",
                    options: ["2 mL/dose", "2.5 mL/dose", "5 mL/dose", "10 mL/dose"],
                    answer: "5 mL/dose",
                    explanation: "Use the formula: Desired / Have x Volume. Ensure units are consistent (g). $$\\small{\\frac{1 \\text{ g (Desired)}}{2 \\text{ g (Have)}} \\times 10 \\text{ mL} = 0.5 \\times 10 \\text{ mL} = 5 \\text{ mL}}$$ "
                }
            ];

            let currentQuestionIndex = 0;
            let userAnswers = [];
            let shuffledQuestions = [];
            
            // --- DOM Element References ---
            const quizContainer = document.getElementById('quiz-container');
            const quizContent = document.getElementById('quiz-content');
            const questionText = document.getElementById('question-text');
            const optionsContainer = document.getElementById('options-container');
            const prevButton = document.getElementById('prev-button');
            const nextButton = document.getElementById('next-button');
            const showExplanationBtn = document.getElementById('show-explanation-btn');
            const explanationBox = document.getElementById('explanation-box');
            const explanationText = document.getElementById('explanation-text');
            const resultsScreen = document.getElementById('results-screen');
            const startButton = document.querySelector('.cta-button');
            const progressBar = document.getElementById('progress-bar');
            const progressText = document.getElementById('progress-text');
            const themeToggleButton = document.getElementById('theme-toggle-btn');

            // --- Utility Functions ---
            const shuffleArray = (array) => {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            };

            // --- Theme Management ---
            const currentTheme = localStorage.getItem('theme');
            if (currentTheme) {
                document.body.setAttribute('data-theme', currentTheme);
            }
            
            themeToggleButton.addEventListener('click', () => {
                const newTheme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
                document.body.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
            });


            // --- Quiz Logic ---
            function startQuiz() {
                shuffledQuestions = shuffleArray([...allQuestions]);
                currentQuestionIndex = 0;
                userAnswers = new Array(shuffledQuestions.length).fill(null);
                
                resultsScreen.style.display = 'none';
                resultsScreen.innerHTML = ''; 
                quizContainer.style.display = 'block';
                quizContent.style.display = 'block';
                document.querySelector('.quiz-actions').style.display = 'flex';
                
                loadQuestion();
            }

            function loadQuestion(isReview = false) {
                quizContent.classList.remove('fade-in');
                quizContent.classList.add('fade-out');

                setTimeout(() => {
                    if (currentQuestionIndex < shuffledQuestions.length) {
                        const q = shuffledQuestions[currentQuestionIndex];
                        
                        questionText.innerHTML = q.question;
                        optionsContainer.innerHTML = '';
                        optionsContainer.classList.remove('disabled');

                        const options = isReview ? q.options : shuffleArray([...q.options]);
                        options.forEach(option => {
                            const button = document.createElement('button');
                            button.classList.add('option-button');
                            button.textContent = option;
                            button.onclick = () => selectOption(option, button);
                            optionsContainer.appendChild(button);
                        });

                        resetExplanation();
                        
                        if (userAnswers[currentQuestionIndex] !== null) {
                            revealAnswer();
                        }
                        
                        updateNavigation();
                        updateProgressBar();
                    }
                    quizContent.classList.remove('fade-out');
                    quizContent.classList.add('fade-in');

                }, 200);
            }

            function selectOption(selectedOption, clickedButton) {
                if (userAnswers[currentQuestionIndex] !== null) return;

                userAnswers[currentQuestionIndex] = selectedOption;
                revealAnswer();
            }
            
            function revealAnswer() {
                const selected = userAnswers[currentQuestionIndex];
                const correct = shuffledQuestions[currentQuestionIndex].answer;
                
                optionsContainer.classList.add('disabled');
                showExplanationBtn.style.display = 'inline-block';

                Array.from(optionsContainer.children).forEach(btn => {
                    if (btn.textContent === correct) {
                        btn.classList.add('correct');
                    } else if (btn.textContent === selected) {
                        btn.classList.add('incorrect');
                    }
                });
            }

            function toggleExplanation() {
                const q = shuffledQuestions[currentQuestionIndex];
                explanationText.innerHTML = q.explanation;
                explanationBox.classList.toggle('show');
                
                if (explanationBox.classList.contains('show')) {
                    showExplanationBtn.textContent = 'Hide Calculation';
                    // Re-render MathJax for the new content
                    if (window.MathJax) {
                        MathJax.typesetPromise([explanationText]);
                    }
                } else {
                    showExplanationBtn.textContent = 'Show Calculation';
                }
            }
            
            function resetExplanation() {
                explanationBox.classList.remove('show');
                showExplanationBtn.textContent = 'Show Calculation';
                showExplanationBtn.style.display = 'none';
            }

            function updateNavigation() {
                prevButton.disabled = currentQuestionIndex === 0;
                nextButton.textContent = currentQuestionIndex === shuffledQuestions.length - 1 ? 'Finish' : 'Next';
            }
            
            function updateProgressBar() {
                const answeredCount = userAnswers.filter(a => a !== null).length;
                const progressPercentage = (answeredCount / shuffledQuestions.length) * 100;
                progressBar.style.width = `${progressPercentage}%`;
                progressText.textContent = `Question ${currentQuestionIndex + 1} of ${shuffledQuestions.length}`;
            }

            function showResults() {
                progressBar.style.width = '100%';
                let score = 0;
                userAnswers.forEach((answer, index) => {
                    if (answer === shuffledQuestions[index].answer) {
                        score++;
                    }
                });

                quizContent.style.display = 'none';
                document.querySelector('.quiz-actions').style.display = 'none';

                resultsScreen.style.display = 'block';
                const percentage = Math.round((score / shuffledQuestions.length) * 100);
                const message = percentage >= 80 ? "Excellent Work! You're a calculation expert." : percentage >= 60 ? "Good job! A little more practice will make perfect." : "Keep practicing! Review your answers to improve.";
                
                resultsScreen.innerHTML = `
                    <div id="result-summary">You Scored <span class="score">${score}</span>/${shuffledQuestions.length} (${percentage}%)</div>
                    <p id="result-message">${message}</p>
                    <button id="restart-button" class="cta-button">Restart Quiz</button>
                    <button id="review-button" class="cta-button" style="background-color: var(--text-muted);">Review Answers</button>
                    <div id="review-area"></div>
                `;
                
                document.getElementById('restart-button').addEventListener('click', startQuiz);
                document.getElementById('review-button').addEventListener('click', buildReview);
            }
            
            function buildReview() {
                const reviewArea = document.getElementById('review-area');
                reviewArea.innerHTML = '<h3 class="section-title" style="font-size: 1.5rem; margin-bottom: 2rem;">Review Your Answers</h3>';
                shuffledQuestions.forEach((q, index) => {
                    const isCorrect = userAnswers[index] === q.answer;
                    const reviewItem = document.createElement('div');
                    reviewItem.className = 'review-question';
                    reviewItem.onclick = () => reviewQuestion(index);
                    reviewItem.innerHTML = `
                        <div class="review-question-text">
                           ${index + 1}. ${q.question.substring(0, 60)}...
                        </div>
                        <div class="review-status ${isCorrect ? 'correct' : 'incorrect'}">
                           <span class="material-icons-sharp">${isCorrect ? 'check_circle' : 'cancel'}</span>
                           <span>${isCorrect ? 'Correct' : 'Incorrect'}</span>
                        </div>
                    `;
                    reviewArea.appendChild(reviewItem);
                });
                document.getElementById('review-button').style.display = 'none';
            }

            function reviewQuestion(index) {
                currentQuestionIndex = index;
                quizContent.style.display = 'block';
                document.querySelector('.quiz-actions').style.display = 'flex';
                resultsScreen.style.display = 'none';
                loadQuestion(true); // pass true for review mode (don't shuffle options)
            }


            // --- Event Listeners ---
            prevButton.addEventListener('click', () => {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    loadQuestion();
                }
            });

            nextButton.addEventListener('click', () => {
                if (userAnswers[currentQuestionIndex] === null) {
                    alert('Please select an answer before proceeding.');
                    return;
                }

                if (currentQuestionIndex < shuffledQuestions.length - 1) {
                    currentQuestionIndex++;
                    loadQuestion();
                } else {
                    showResults();
                }
            });

            showExplanationBtn.addEventListener('click', toggleExplanation);

            startButton.addEventListener('click', (e) => {
                 e.preventDefault();
                 const targetSection = document.querySelector(startButton.getAttribute('href'));
                 targetSection.scrollIntoView({ behavior: 'smooth' });
                 setTimeout(startQuiz, 500); // Wait for scroll to finish
            });
        });
    </script>
</body>
</html>
